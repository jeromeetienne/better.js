var QGetterSetter={};QGetterSetter._Property=function(baseObject,property){console.assert(typeof baseObject==="object"||typeof baseObject==="function");console.assert(typeof property==="string");var originValue=baseObject[property];var _this=this;this._getters=[];this._setters=[];baseObject.__defineGetter__(property,function getterHandler(){var value=baseObject["__"+property];for(var i=0;i<_this._getters.length;i++){value=_this._getters[i](value,getterHandler.caller,property)}return value});baseObject.__defineSetter__(property,function(value){for(var i=0;i<_this._setters.length;i++){value=_this._setters[i](value)}baseObject["__"+property]=value});baseObject["__"+property]=originValue};if(typeof window==="undefined")module.exports=QGetterSetter;QGetterSetter.defineGetter=function(baseObject,property,getterFn){var name="__dbgGetSet_"+property;baseObject[name]=baseObject[name]||new QGetterSetter._Property(baseObject,property);baseObject[name]._getters.push(getterFn)};QGetterSetter.defineSetter=function(baseObject,property,setterFn){var name="__dbgGetSet_"+property;baseObject[name]=baseObject[name]||new QGetterSetter._Property(baseObject,property);baseObject[name]._setters.push(setterFn)};QGetterSetter.overloadObjectPrototype=function(){Object.prototype.__defineQGetter__=function(property,getterFn){QGetterSetter.defineGetter(this,property,getterFn)};Object.prototype.__defineQSetter__=function(property,setterFn){QGetterSetter.defineSetter(this,property,setterFn)}};var Stacktrace={};if(typeof window==="undefined")module.exports=Stacktrace;Stacktrace.parse=function(nShift,error){nShift=nShift!==undefined?nShift:0;error=error||new Error;console.assert(error instanceof Error);if(typeof window==="undefined"){var stacktrace=_parserV8(error)}else if(navigator.userAgent.match("Chrome/")){var stacktrace=_parserV8(error)}else if(navigator.userAgent.match("Firefox/")){var stacktrace=_parserFirefox(error)}else{console.assert(false,"Stacktrace.parse() not yet implemented for",navigator.userAgent);return[]}nShift+=1;console.assert(stacktrace.length>=nShift,"stacktrace length not large enougth to shift "+nShift);return stacktrace.slice(nShift);function _parserV8(error){var lines=error.stack.split("\n").slice(1);var stacktrace=[];lines.forEach(function(line){if(line.match(/\(native\)$/)){var matches=line.match(/^\s*at (.+) \(native\)/);stacktrace.push(new Stacktrace.Frame({fct:matches[1],url:"native",line:1,column:1}))}else if(line.match(/\)$/)){var matches=line.match(/^\s*at (.+) \((.+):(\d+):(\d+)\)/);stacktrace.push(new Stacktrace.Frame({fct:matches[1],url:matches[2],line:parseInt(matches[3],10),column:parseInt(matches[4],10)}))}else{var matches=line.match(/^\s*at (.+):(\d+):(\d+)/);stacktrace.push(new Stacktrace.Frame({url:matches[1],fct:"<anonymous>",line:parseInt(matches[2],10),column:parseInt(matches[3],10)}))}});return stacktrace}function _parserFirefox(error){var lines=error.stack.split("\n").slice(0,-1);var stacktrace=[];lines.forEach(function(line){var matches=line.match(/^(.*)@(.+):(\d+)$/);stacktrace.push(new Stacktrace.Frame({fct:matches[1]===""?"<anonymous>":matches[1],url:matches[2],line:parseInt(matches[3],10),column:1}))});return stacktrace}};Stacktrace.Frame=function(opts){this.url=opts.url;this.fct=opts.fct;this.line=opts.line;this.column=opts.column};Stacktrace.Frame.prototype.originId=function(){var str=this.fct+"@"+this.url+":"+this.line+":"+this.column;return str};Stacktrace.Frame.prototype.basename=function(){return this.url.match(/([^/]*)$/)[1]||"."};Stacktrace.Tracker=function(){this._klasses={}};Stacktrace.Tracker.prototype.record=function(className,stackLevel){stackLevel=stackLevel!==undefined?stackLevel:0;var at=Stacktrace.Track;var stackFrame=Stacktrace.parse()[stackLevel+2];this._klasses[className]=this._klasses[className]||{counter:0,perOrigins:{}};var klass=this._klasses[className];klass.counter+=1;var originId=stackFrame.fct+"@"+stackFrame.url+":"+stackFrame.line;var perOrigins=klass.perOrigins;perOrigins[originId]=perOrigins[originId]!==undefined?perOrigins[originId]:0;perOrigins[originId]+=1};Stacktrace.Tracker.prototype.reset=function(){this._klasses={}};Stacktrace.Tracker.prototype.klasses=function(){return this._klasses};Stacktrace.Tracker.prototype.dump=function(){var report=this.reportString.apply(this,arguments);console.log(report)};Stacktrace.Tracker.prototype.reportString=function(classNameRegExp,maxNOrigin){classNameRegExp=classNameRegExp||/./;maxNOrigin=maxNOrigin!==undefined?maxNOrigin:3;var output=[];var classNames=Object.keys(this._klasses);classNames.sort(function(a,b){return this._klasses[b].counter-this._klasses[a].counter}.bind(this));classNames=classNames.filter(function(className){return className.match(classNameRegExp)?true:false});classNames.forEach(function(className){var klass=this._klasses[className];output.push(className+": total "+klass.counter+" times");var perOrigins=klass.perOrigins;var ranks=Object.keys(perOrigins);ranks.sort(function(a,b){return perOrigins[b]-perOrigins[a]});ranks.slice(0,maxNOrigin).forEach(function(originId){var perOrigin=perOrigins[originId];output.push("	"+originId+" - "+perOrigin+" times")})}.bind(this));return output.join("\n")};var assertWhichStop=function(condition,message,useDebugger){if(condition)return;if(assertWhichStop.useDebugger||useDebugger)debugger;throw new Error(message||"Assert Failed")};assertWhichStop.useDebugger=false;if(typeof window==="undefined")module.exports=assertWhichStop;assertWhichStop.overloadConsole=function(){console.assert=assertWhichStop};var Stacktrace=Stacktrace||require("./stacktrace.js");var ConsoleLogger={};ConsoleLogger._origConsole={console:console,log:console.log,warn:console.warn,error:console.error};if(typeof window==="undefined")module.exports=ConsoleLogger;ConsoleLogger.Severity={all:0,log:1,warn:2,error:3,nothing:99};ConsoleLogger.Severity.dfl=ConsoleLogger.Severity.all;ConsoleLogger.formatterIdentity=function(args,stackFrame,severity){return args};ConsoleLogger.formatterTimeStamp=function(args,stackFrame,severity){var present=new Date;var prefixColor=ConsoleLogger._formatterSeverityColor(severity);var prefix=prefixColor+pad(present.getHours(),2)+":"+pad(present.getMinutes(),2)+":"+pad(present.getSeconds(),2)+ConsoleLogger._formatterColor.reset;args=Array.prototype.slice.call(args,0);args.unshift(prefix);return args;function pad(val,len){val=String(val);while(val.length<len)val="0"+val;return val}};ConsoleLogger.formatterOrigin=function(args,stackFrame,severity){var prefixColor=ConsoleLogger._formatterSeverityColor(severity);var prefix=prefixColor+stackFrame.originId()+ConsoleLogger._formatterColor.reset;args=Array.prototype.slice.call(args,0);args.unshift(prefix);return args};ConsoleLogger._inNode=typeof window==="undefined"?true:false;ConsoleLogger._formatterColor={black:ConsoleLogger._inNode===false?"":"[30m",red:ConsoleLogger._inNode===false?"":"[31m",green:ConsoleLogger._inNode===false?"":"[32m",yellow:ConsoleLogger._inNode===false?"":"[33m",blue:ConsoleLogger._inNode===false?"":"[34m",purple:ConsoleLogger._inNode===false?"":"[35m",cyan:ConsoleLogger._inNode===false?"":"[36m",white:ConsoleLogger._inNode===false?"":"[37m",reset:ConsoleLogger._inNode===false?"":"[0m"};ConsoleLogger._formatterSeverityColor=function(severity){var color=ConsoleLogger._formatterColor;if(severity==="log")return color.red;if(severity==="warn")return color.purple;return color.green};ConsoleLogger.formatter=ConsoleLogger.formatterIdentity;ConsoleLogger._filters=[];ConsoleLogger.pushFilter=function(validFor,severity){if(typeof validFor==="string"){var path=validFor;return ConsoleLogger.pushFilter(function(stackFrame,severity){return stackFrame.url.lastIndexOf(path)===stackFrame.url.length-path.length?true:false},severity)}else if(validFor instanceof RegExp){var regexp=validFor;return ConsoleLogger.pushFilter(function(stackFrame,severity){return stackFrame.url.match(regexp)?true:false},severity)}console.assert(Object.keys(ConsoleLogger.Severity).indexOf(severity)!==-1,"unknown severity level");console.assert(validFor instanceof Function);ConsoleLogger._filters.push({validFor:validFor,severity:ConsoleLogger.Severity[severity]})};ConsoleLogger.filter=function(severity,stackFrame){stackFrame=stackFrame||Stacktrace.parse()[2];console.assert(Object.keys(ConsoleLogger.Severity).indexOf(severity)!==-1,"unknown severity level");var filters=ConsoleLogger._filters;for(var i=0;i<filters.length;i++){var filter=filters[i];if(filter.validFor(stackFrame)===false)continue;return ConsoleLogger.Severity[severity]>=filter.severity?true:false}return ConsoleLogger.Severity[severity]>=ConsoleLogger.Severity.dfl?true:false};ConsoleLogger._print=function(severity,args){var stackFrame=Stacktrace.parse()[2];if(ConsoleLogger.filter(severity,stackFrame)===false)return;var args=ConsoleLogger.formatter(args,stackFrame,severity);var _console=ConsoleLogger._origConsole;if(severity==="log"){_console.log.apply(_console.console,args)}else if(severity==="warn"){_console.warn.apply(_console.console,args)}else if(severity==="error"){_console.error.apply(_console.console,args)}else console.assert(false,"invalid severity: "+severity)};ConsoleLogger.log=function(){ConsoleLogger._print("log",arguments)};ConsoleLogger.warn=function(){ConsoleLogger._print("warn",arguments)};ConsoleLogger.error=function(){ConsoleLogger._print("error",arguments)};ConsoleLogger.overloadConsole=function(){console.log=ConsoleLogger.log;console.warn=ConsoleLogger.warn;console.error=ConsoleLogger.error};var GcMonitor=function(){var _this=this;var timerid=null;var inNode=typeof window==="undefined"?true:false;var usedHeapSize=inNode?function(){return process.memoryUsage().heapUsed}:function(){if(!window.performance||!window.performance.memory)return 0;return window.performance.memory.usedJSHeapSize};if(GcMonitor.isAvailable()===false){console.warn("memory info are unavailable... for chrome, use --enable-memory-info. Other browsers dont have this feature.")}this.start=function(onChange,period){period=period||1e3/60;onChange=onChange||function(delta){function bytesToSize(bytes,nFractDigit){var sizes=["Bytes","KB","MB","GB","TB"];if(bytes==0)return"0";nFractDigit=nFractDigit!==undefined?nFractDigit:2;var precision=Math.pow(10,nFractDigit);var i=Math.floor(Math.log(bytes)/Math.log(1024));return Math.round(bytes*precision/Math.pow(1024,i))/precision+" "+sizes[i]}console.warn(new Date+" -- GC occured! saved",bytesToSize(delta),"consuming at",bytesToSize(burnRate),"per second")};timerid=setInterval(function(){_this.check(onChange)},period);return this};this.stop=function(){cancelInterval(timerid)};var lastUsedHeap=null;var lastTimestamp=null;var burnRate=null;this.check=function(onChange){onChange=onChange||function(property){};var present=Date.now();var currUsedSize=usedHeapSize();if(lastUsedHeap===null){lastUsedHeap=currUsedSize;lastTimestamp=present;return}var deltaMem=currUsedSize-lastUsedHeap;if(deltaMem<0){onChange(-deltaMem,burnRate)}else{var deltaTime=present-lastTimestamp;var newBurnrate=deltaMem/(deltaTime/1e3);if(burnRate===null)burnRate=newBurnrate;var friction=.99;burnRate=burnRate*friction+newBurnrate*(1-friction)}lastUsedHeap=currUsedSize;lastTimestamp=present};this.burnRate=function(){if(burnRate===null)return 0;return burnRate};this.usedHeapSize=function(){return usedHeapSize()}};GcMonitor.isAvailable=function(){var inNode=typeof window==="undefined"?true:false;if(inNode)return true;if(!window.performance)return false;if(!window.performance.memory)return false;return true};if(typeof window==="undefined")module.exports=GcMonitor;var GlobalDetector=function(){var inBrowser=typeof window!=="undefined"?true:false;var _global=inBrowser?window:global;console.assert(_global,"failed to find a global namespace! bailing out!");var initialGlobals={};for(var propname in _global){initialGlobals[propname]=true}var foundGlobals={};var _this=this;var timerid=null;this.start=function(onChange,period){period=period||1e3;onChange=onChange||function(newProperty){var str=new Date+" -- Warning Global Detected!!! ";str+=inBrowser?"window":"global";str+="['"+newProperty+"'] === "+_global[newProperty];console.warn(str)};timerid=setInterval(function(){_this.check(onChange)},period);return this};this.stop=function(){cancelInterval(_timerid)};this.check=function(onChange){var newGlobal=false;onChange=onChange||function(property){};for(var property in _global){if(initialGlobals[property])continue;if(GlobalDetector.ignoreList.indexOf(property)!==-1)continue;if(foundGlobals[property])continue;foundGlobals[property]=true;newGlobal=true;onChange(property)}return newGlobal};this.foundGlobals=function(){return foundGlobals}};GlobalDetector.ignoreList=[];if(typeof window==="undefined")module.exports=GlobalDetector;var PrivateForJS={};var Stacktrace=Stacktrace||require("./stacktrace.js");var QGetterSetter=QGetterSetter||require("./qgettersetter.js");if(typeof window==="undefined")module.exports=PrivateForJS;PrivateForJS.pushPrivateOkFn=function(klass,source){if(source===undefined)source=klass.prototype;klass._privateOkFn=klass._privateOkFn||[];if(typeof source==="function"){klass._privateOkFn.push(source)}else if(typeof source==="object"){Object.keys(source).forEach(function(key){var val=source[key];if(typeof val!=="function")return;klass._privateOkFn.push(val)})}else if(source instanceof Array){source.forEach(function(fn){console.assert(typeof val!=="function");klass._privateOkFn.push(fn)})}else console.assert(false)};PrivateForJS.getPrivateOkFn=function(klass){klass._privateOkFn=klass._privateOkFn||[];return klass._privateOkFn};PrivateForJS.privateProperty=function(klass,baseObject,property){QGetterSetter.defineGetter(baseObject,property,function aFunction(value,caller,property){klass._privateOkFn=klass._privateOkFn||PrivateForJS.pushPrivateOkFn(klass);var privateOkFns=klass._privateOkFn;if(privateOkFns.indexOf(caller)===-1){var stackFrame=Stacktrace.parse()[2];console.assert(false,"access to private property","'"+property+"'","from",stackFrame.orginId())}return value})};PrivateForJS.privateFunction=function(klass,fn){var _this=this;return function _checkPrivateFunction(){var caller=_checkPrivateFunction.caller;klass._privateOkFn=klass._privateOkFn||PrivateForJS.pushPrivateOkFn(klass);var privateOkFns=klass._privateOkFn;if(privateOkFns.indexOf(caller)===-1){var stackFrame=Stacktrace.parse()[1];console.assert(false,"access to private property","'"+property+"'","from",stackFrame.orginId())}return fn.apply(_this,arguments)}};var TypeCheck={};var QGetterSetter=QGetterSetter||require("../src/qgettersetter.js");if(typeof window==="undefined")module.exports=TypeCheck;TypeCheck.setter=function(baseObject,property,types){var value=baseObject[property];var isValid=TypeCheck.value(value,types);console.assert(isValid,"initial value got invalid type");QGetterSetter.defineSetter(baseObject,property,function(value){var isValid=TypeCheck.value(value,types);console.assert(isValid,"invalid type value="+value+" types="+types);return value})};TypeCheck.fn=function(originalFn,paramsTypes,returnTypes){return function TypeCheck_fn(){console.assert(arguments.length<=paramsTypes.length,"function received "+arguments.length+" parameters but allows only "+paramsTypes.length+"!");for(var i=0;i<paramsTypes.length;i++){var isValid=TypeCheck.value(arguments[i],paramsTypes[i]);console.assert(isValid,"argument["+i+"] type is invalid. MUST be of type",paramsTypes[i],"It is ===",arguments[i])}var result=originalFn.apply(this,arguments);var isValid=TypeCheck.value(result,returnTypes);console.assert(isValid,"invalid type for returned value. MUST be of type",returnTypes,"It is ===",result);return result}};TypeCheck.value=function(value,types){if(types instanceof Array===false)types=[types];if(types.length===0)return true;var result=false;for(var i=0;i<types.length;i++){var type=types[i];if(type===Number){var valid=typeof value==="number"}else if(type===String){var valid=typeof value==="string"}else if(typeof type==="string"&&type.toLowerCase()==="always"){var valid=true}else if(typeof type==="string"&&type.toLowerCase()==="never"){return false}else if(typeof type==="string"&&type.toLowerCase()==="nonan"){var valid=value===value;if(valid===false)return false;continue}else if(type instanceof TypeCheck._ValidatorClass){var valid=type.fn(value);if(valid===false)return false;continue}else{var valid=value instanceof type}result=result||valid}return result};TypeCheck.Validator=function(fn){return new TypeCheck._ValidatorClass(fn)};TypeCheck._ValidatorClass=function(fn){console.assert(fn instanceof Function);this.fn=fn};var FunctionAttr={};FunctionAttr.define=function(originalFn,fnName){return new FunctionAttr.Builder(originalFn,fnName)};FunctionAttr.wrapCall=function(originalFn,beforeFn,afterFn){return function(){var stopNow=false;if(beforeFn)stopNow=beforeFn(originalFn,arguments);var result=originalFn.apply(this,arguments);if(afterFn)afterFn(originalFn,arguments,result);return result}};FunctionAttr.Builder=function(originalFn,fnName){this._currentFn=originalFn;this._fnName=fnName||"aFunction"};FunctionAttr.Builder.prototype.done=function(){return this._currentFn};if(typeof window==="undefined")module.exports=FunctionAttr;FunctionAttr.Builder.prototype.timestamp=function(message){this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){console.log(""+new Date+": "+this._fnName+" being called")}.bind(this));return this};FunctionAttr.Builder.prototype.log=function(message){this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){console.log(message)});return this};FunctionAttr.Builder.prototype.deprecated=function(message){var used=false;this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){if(used)return;used=true;console.warn(message||"Deprecated function "+this._fnName+" called. Please update your code.")}.bind(this));return this};FunctionAttr.Builder.prototype.obsolete=function(message){var used=false;this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){if(used)return;used=true;console.assert(false,message||"Obsoleted function "+this._fnName+" called. Please update your code.")}.bind(this));return this};FunctionAttr.Builder.prototype.before=function(beforeFn){this._currentFn=FunctionAttr.wrapCall(this._currentFn,beforeFn,null);return this};FunctionAttr.Builder.prototype.after=function(afterFn){this._currentFn=FunctionAttr.wrapCall(this._currentFn,null,afterFn);return this};FunctionAttr.Builder.prototype.time=function(label){label=label!==undefined?label:this._fnName+".time()-"+Math.floor(Math.random()*9999).toString(36);this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){console.time(label)},function(){console.timeEnd(label)});return this};FunctionAttr.Builder.prototype.profile=function(label){label=label!==undefined?label:this._fnName+".profile-"+Math.floor(Math.random()*9999).toString(36);this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){console.profile(label)},function(){console.profileEnd(label)});return this};FunctionAttr.Builder.prototype.breakpoint=function(fn,conditionFn){conditionFn=conditionFn||function(){return true};this._currentFn=function(){var stopNow=conditionFn();if(stopNow===true)debugger;return this._currentFn.apply(this,arguments)}.bind(this);return this};var TypeCheck=TypeCheck||require("../src/typecheck.js");FunctionAttr.Builder.prototype.typeCheck=function(paramsTypes,returnTypes){this._currentFn=TypeCheck.fn(this._currentFn,paramsTypes,returnTypes);return this};var Stacktrace=Stacktrace||require("../src/stacktrace.js");FunctionAttr.usageTracker=new Stacktrace.Tracker;FunctionAttr.Builder.prototype.trackUsage=function(trackName){var tracker=FunctionAttr.usageTracker;trackName=trackName||"FunctionAttr.trackUsage:"+Stacktrace.parse()[1].originId();this._currentFn=FunctionAttr.wrapCall(this._currentFn,function(){tracker.record(trackName,1)});return this};var PrivateForJS=PrivateForJS||require("../src/privateforjs.js");FunctionAttr.Builder.prototype.private=function(klass){console.assert(klass!==undefined);this._currentFn=PrivateForJS.privateFunction(klass,this_currentFn);return this};var PropertyAttr={};PropertyAttr.define=function(baseObject,property){return new PropertyAttr.Builder(baseObject,property)};PropertyAttr.Builder=function(baseObject,property){console.assert(typeof baseObject==="object"||typeof baseObject==="function");console.assert(typeof property==="string");this._baseObject=baseObject;this._property=property};if(typeof window==="undefined")module.exports=PropertyAttr;var TypeCheck=TypeCheck||require("../src/typecheck.js");PropertyAttr.Builder.prototype.typeCheck=function(types){TypeCheck.setter(this._baseObject,this._property,types);return this};var QGetterSetter=QGetterSetter||require("../src/qgettersetter.js");var Stacktrace=Stacktrace||require("../src/stacktrace.js");PropertyAttr.usageTracker=new Stacktrace.Tracker;PropertyAttr.Builder.prototype.trackUsage=function(trackName){var tracker=PropertyAttr.usageTracker;trackName=trackName||"PropertyAttr.trackUsage:"+Stacktrace.parse()[1].originId();QGetterSetter.defineGetter(this._baseObject,this._property,function(value){tracker.record(trackName,1);return value});QGetterSetter.defineSetter(this._baseObject,this._property,function(value){tracker.record(trackName,1);return value});return this};var PrivateForJS=PrivateForJS||require("../src/privateforjs.js");PropertyAttr.Builder.prototype.private=function(klass){PrivateForJS.privateProperty(klass,this._baseObject,this._property);return this};var ObjectIcer={};ObjectIcer.readProperties=function(target){console.assert(Proxy.create!=="function","harmony proxy not enable. try chrome://flags or node --harmony");return Proxy.create({get:function(proxy,name){console.assert(name in target!==false,"property "+name+" undefined");return target[name]}})};ObjectIcer.readProperties.available=typeof Proxy!=="undefined"&&typeof Proxy.create==="function";ObjectIcer.writeProperties=function(target){Object.seal(target);return target};ObjectIcer.rwProperties=function(target){target=ObjectIcer.writeProperties(target);target=ObjectIcer.readProperties(target);return target};if(typeof window==="undefined")module.exports=ObjectIcer;var DEBUG={};DEBUG.assertWhichStop=assertWhichStop;DEBUG.ConsoleLogger=ConsoleLogger;DEBUG.FunctionAttr=FunctionAttr;DEBUG.GcMonitor=GcMonitor;DEBUG.GlobalDetector=GlobalDetector;DEBUG.ObjectIcer=ObjectIcer;DEBUG.PrivateForJS=PrivateForJS;DEBUG.PropertyAttr=PropertyAttr;DEBUG.QGetterSetter=QGetterSetter;DEBUG.Stacktrace=Stacktrace;DEBUG.TypeCheck=TypeCheck;if(typeof window==="undefined"){module.exports=DEBUG}DEBUG.assert=assertWhichStop;DEBUG.overloadConsoleAssert=assertWhichStop.overloadConsole;DEBUG.iceObjectRead=ObjectIcer.readProperties;DEBUG.iceObjectWrite=ObjectIcer.writeProperties;DEBUG.iceObject=ObjectIcer.rwProperties;DEBUG.defineQGetter=QGetterSetter.defineGetter;DEBUG.defineQSetter=QGetterSetter.defineSetter;